!function(){"use strict";function e(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function t(t,n){if(!e(t,n))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}var o=function(){function e(){t(this,e)}return i(e,null,[{key:"prepare",value:function(e,t,n){var i=_.findIndex(e,function(e){return"clipboard"===e.name}),o=_.findIndex(e,function(e){return"addNew"===e.name});return o>=0&&e[o].actions.push({name:"x-insert",title:"Add Nested Section",icon:"hm hm-happyaddons",callback:function(){a.insert(t)},isEnabled:function(){return!0}}),e.splice(i+1,0,{name:"ha-clipboard",actions:[{name:"x-copy",title:"X Copy",icon:"hm hm-happyaddons",callback:function(){n.copy(t)}},{name:"x-paste",title:"X Paste",icon:"hm hm-happyaddons",callback:function(){n.paste(t)}},{name:"live-paste",title:"Live Paste",icon:"hm hm-happyaddons",callback:function(){n.paste(t)}}]}),e}},{key:"prepareForBlankColumn",value:function(e,t,n){return e.push({name:"ha-clipboard",actions:[{name:"x-paste",title:"X Paste",icon:"hm hm-happyaddons",callback:function(){n.paste(t)},isEnabled:function(){return!0}},{name:"live-paste",title:"Live Paste",icon:"hm hm-happyaddons",callback:function(){n.paste(t)},isEnabled:function(){return!0}},{name:"x-insert",title:"Add Nested Section",icon:"hm hm-happyaddons",callback:function(){a.insert(t)},isEnabled:function(){return!0}}]}),e}}]),e}(),a=function(){function e(){t(this,e)}return i(e,null,[{key:"insert",value:function(e){var t=e.getContainer().view;"column"===t.getElementType()&&t.addElement({elType:"section",isInner:!0,settings:{},elements:[{id:elementor.helpers.getUniqueID(),elType:"column",isInner:!0,settings:{_column_size:100},elements:[]}]})}}]),e}(),r=function(){function e(n,i){t(this,e),this.widgetType=n,this.widgetCode=i}return i(e,[{key:"getWidgetType",value:function(){return this.widgetType}},{key:"getWidgetCode",value:function(){return this.widgetCode}},{key:"toJSON",value:function(){return{widgetType:this.widgetType,widgetCode:this.widgetCode}}}]),e}(),s=function(){function e(n){t(this,e),this.widgetStorage=n,this.lastCopiedElement="",this.lastPastedElementModel={}}return i(e,[{key:"copy",value:function(e){var t=new r(e.model.get("widgetType"),e.model.toJSON());this.widgetStorage.save(t)}},{key:"paste",value:function(e){var t=this;this.widgetStorage.fetch(function(n){var i=n.widgetCode,o=JSON.stringify(i),a=/\.(gif|jpg|jpeg|svg|png)/gi.test(o),r=e.model.get("elType"),s=i.elType,l={elType:s,settings:i.settings},c=null,u={at:0};if("section"===s){var d=null;"widget"===r?d=e.getContainer().parent.parent:"column"===r?d=e.getContainer().parent:"section"===r&&(d=e.getContainer()),l.elements=i.elements,c=d.parent,u.at=d.view.getOption("_index")+1,d.model.get("isInner")&&(l.isInner=!0)}else"column"===s?(l.elements=i.elements,"widget"===r?(c=e.getContainer().parent.parent,u.at=e.getContainer().parent.view.getOption("_index")+1):"column"===r?(c=e.getContainer().parent,u.at=e.getOption("_index")+1):"section"===r&&(c=e.getContainer())):"widget"===s&&(l.widgetType=i.widgetType,c=e.getContainer(),"widget"===r?(c=e.getContainer().parent,u.at=e.getOption("_index")+1):"column"===r?c=e.getContainer():"section"===r&&(c=e.children.findByIndex(0).getContainer()));if(a&&!_.isEmpty(t.lastPastedElementModel)&&t.lastCopiedElement===o)return u.clone=!0,void $e.run("document/elements/create",{model:t.lastPastedElementModel,container:c,options:u});var p=$e.run("document/elements/create",{model:l,container:c,options:u});a&&jQuery.ajax({url:marvin.ajaxURL,method:"POST",data:{nonce:marvin.nonce,action:"ha_process_image_import",content:o},beforeSend:function(){p.view.$el.addClass("ha-processing-import").attr("data-ha-processing-import-title","Processing images...")}}).done(function(e){if(e.success){var n=e.data[0];l.settings=n.settings,l.elType=n.elType,"widget"===n.elType?l.widgetType=n.widgetType:l.elements=n.elements,p.view.$el.attr("data-ha-processing-import-title","Image processing completed.");var i=setTimeout(function(){$e.run("document/elements/delete",{container:p});var e=$e.run("document/elements/create",{model:l,container:c,options:u});t.lastPastedElementModel=elementorCommon.helpers.cloneObject(e.model.toJSON()),clearTimeout(i)},750)}}),t.lastCopiedElement=o})}}]),e}(),l=function(){function e(n){t(this,e),this.storageKey=n,xdLocalStorage.init({iframeUrl:"https://happyaddons.com/marvin/index.html",initCallback:function(){}})}return i(e,[{key:"save",value:function(e){xdLocalStorage.setItem(this.storageKey,JSON.stringify(e))}},{key:"fetch",value:function(e){return xdLocalStorage.getItem(this.storageKey,function(t){var n=JSON.parse(t.value),i=new r(n.widgetType,n.widgetCode);e(i)})}}]),e}(),c=function(){function e(n,i,o){t(this,e),this.storageKey=n,this.storageEndpoint=i,this.$=o}return i(e,[{key:"save",value:function(e){this.$.post(this.storageEndpoint,{key:this.storageKey,data:JSON.stringify(e)})}},{key:"fetch",value:function(e){this.$.get(this.storageEndpoint,{key:this.storageKey},function(t){var n=JSON.parse(t),i=new r(n.widgetType,n.widgetCode);e(i)})}}]),e}();window.HWidgetStorage=l,window.HSWidgetStorage=c,window.HClipBoard=s,window.HWidget=r;var u=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),d=elementor.hooks.addFilter,p=u?new c(marvin.storageKey,"https://happymonster.dev/storage/safari.php",$):new l(marvin.storageKey),m=new s(p);d("elements/widget/contextMenuGroups",function(e,t){return o.prepare(e,t,m)}),d("elements/section/contextMenuGroups",function(e,t){return o.prepare(e,t,m)}),d("elements/column/contextMenuGroups",function(e,t){return o.prepare(e,t,m)}),d("element/view",function(e,t){var n;return"column"===t.get("elType")?e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),n=this},emptyView:e.prototype.emptyView.extend({getContextMenuGroups:function(){var t=e.prototype.emptyView.prototype.getContextMenuGroups.apply(this,arguments);return o.prepareForBlankColumn(t,n,m)}})}):e})}();